<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>LEE YUNHA – DETAIL</title>
  <link rel="stylesheet" href="./css/style.css"/>
</head>

<body>

<a class="detail-back" href="javascript:history.back()">&larr;</a>

<div class="detail-hero" id="detailHero">
  <div class="detail-btn prev" id="detailPrev">&#10094;</div>
  <div class="detail-btn next" id="detailNext">&#10095;</div>
</div>

<div class="detail-body">
  <div class="detail-meta" id="detailMeta"></div>
  <div class="detail-text" id="detailText"></div>
</div>

<div class="footer">© 2025 LEE YUNHA. All rights reserved.</div>

<script>
  // ============================================
  // 1) 설명 텍스트 관리 (여기만 채우면 됩니다)
  //    - meta: 작품 정보 한 줄
  //    - text: 본문(줄바꿈 유지됨)
  // ============================================
  const TEXT = {
    color: {
      1: { meta: "", text: "" },
      2: { meta: "", text: "" },
      3: { meta: "", text: "" },
      4: { meta: "", text: "" },
      5: { meta: "", text: "" },
      6: { meta: "", text: "" },
      7: { meta: "", text: "" },
      8: { meta: "", text: "" },
      9: { meta: "", text: "" },
      10:{ meta: "", text: "" },
      11:{ meta: "", text: "" },
      12:{ meta: "", text: "" },
    },
    ink: {
      1: { meta: "", text: "" },
      2: { meta: "", text: "" },
      3: { meta: "", text: "" },
      4: { meta: "", text: "" },
      5: { meta: "", text: "" },
      6: { meta: "", text: "" },
      7: { meta: "", text: "" },
      8: { meta: "", text: "" },
      9: { meta: "", text: "" },
      10:{ meta: "", text: "" },
      11:{ meta: "", text: "" },
      12:{ meta: "", text: "" },
      13:{ meta: "", text: "" },
      14:{ meta: "", text: "" },
      15:{ meta: "", text: "" },
      16:{ meta: "", text: "" },
      17:{ meta: "", text: "" },
      18:{ meta: "", text: "" },
      19:{ meta: "", text: "" },
      20:{ meta: "", text: "" },
      21:{ meta: "", text: "" },
    }
  };

  // ============================================
  // 2) 이미지 자동 로딩 규칙
  //
  // ✅ 단일 이미지:
  //   ./assets/{type}/detail-01.png
  //
  // ✅ 여러 장(슬라이드):
  //   ./assets/{type}/detail-01-01.png
  //   ./assets/{type}/detail-01-02.png
  //   ./assets/{type}/detail-01-03.png ...
  //
  // (최대 20장까지 자동 탐색)
  // ============================================
  function pad2(n){ return String(n).padStart(2, "0"); }

  function tryLoad(src){
    return new Promise(resolve => {
      const img = new Image();
      img.onload = () => resolve(true);
      img.onerror = () => resolve(false);
      img.src = src;
    });
  }

  async function buildImageList(type, id){
    const base = `./assets/${type}/detail-${pad2(id)}`;
    const multi = [];

    // 1) 여러 장(detail-01-01.png ~ detail-01-20.png) 먼저 탐색
    for (let i = 1; i <= 20; i++){
      const src = `${base}-${pad2(i)}.png`;
      const ok = await tryLoad(src);
      if (ok) multi.push(src);
      else {
        // 중간부터 없는 경우가 많아서, 첫 실패 후 2번 더 확인하고 종료
        if (i <= 2) continue;
        break;
      }
    }

    if (multi.length > 0) return multi;

    // 2) 단일(detail-01.png) fallback
    const single = `${base}.png`;
    const okSingle = await tryLoad(single);
    if (okSingle) return [single];

    // 3) 아무 것도 없으면 빈 배열
    return [];
  }

  // ============================================
  // 3) URL 파라미터
  // ============================================
  const qs = new URLSearchParams(location.search);
  const type = (qs.get("type") || "").toLowerCase(); // "color" or "ink"
  const id = parseInt(qs.get("id") || "1", 10);

  const hero = document.getElementById("detailHero");
  const metaEl = document.getElementById("detailMeta");
  const textEl = document.getElementById("detailText");
  const prevBtn = document.getElementById("detailPrev");
  const nextBtn = document.getElementById("detailNext");

  // 텍스트 표시
  const textItem = (TEXT[type] && TEXT[type][id]) ? TEXT[type][id] : { meta:"", text:"" };
  metaEl.textContent = textItem.meta || "";
  textEl.textContent = textItem.text || "";

  // 슬라이드 렌더링
  (async function init(){
    const imgs = await buildImageList(type, id);

    if (!imgs.length){
      metaEl.textContent = metaEl.textContent || "이미지 파일을 찾을 수 없습니다.";
      textEl.textContent = textEl.textContent || `assets/${type}/detail-${pad2(id)}.png 또는 detail-${pad2(id)}-01.png 규칙으로 파일을 넣어주세요.`;
      prevBtn.style.display = "none";
      nextBtn.style.display = "none";
      return;
    }

    let idx = 0;

    function render(){
      hero.querySelectorAll(".slide").forEach(n => n.remove());

      imgs.forEach((src, i) => {
        const d = document.createElement("div");
        d.className = "slide" + (i === idx ? " active" : "");
        const im = document.createElement("img");
        im.src = src;
        im.alt = "";
        d.appendChild(im);
        hero.insertBefore(d, prevBtn);
      });

      const multi = imgs.length > 1;
      prevBtn.style.display = multi ? "block" : "none";
      nextBtn.style.display = multi ? "block" : "none";
    }

    function move(n){
      idx = (n + imgs.length) % imgs.length;
      render();
    }

    prevBtn.addEventListener("click", () => move(idx - 1));
    nextBtn.addEventListener("click", () => move(idx + 1));

    render();
  })();
</script>

</body>
</html>
